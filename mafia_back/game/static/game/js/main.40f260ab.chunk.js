(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{154:function(e,a,t){e.exports=t.p+"static/media/player_hidden.b61c0d0d.png"},159:function(e,a,t){e.exports=t(335)},303:function(e,a,t){},330:function(e,a,t){},331:function(e,a,t){},335:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),s=t(145),c=t.n(s),i=t(25),o=t(50),l=t(16),m=t(156),d=t(17),u=t(157),p=t(7),f=t(6),v=t(9),E=t(8),g=t(10),h=(t(164),t(95)),y=t.n(h),b=t(32),N=function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){var e=this,a=Boolean(localStorage.getItem("token"))?r.a.createElement(n.Fragment,null,r.a.createElement("li",null,r.a.createElement(i.b,{to:"profile"},"Profile")),r.a.createElement("li",null,r.a.createElement(i.b,{to:"games"},"Games")),r.a.createElement("li",null,r.a.createElement("a",{href:"#",onClick:function(a){localStorage.removeItem("token"),e.props.history.push("/")}},"Logout"))):r.a.createElement(n.Fragment,null,r.a.createElement("li",null,r.a.createElement(i.b,{to:"login"},"Login")),r.a.createElement("li",null,r.a.createElement(i.b,{to:"reg"},"Register")));return r.a.createElement(n.Fragment,null,r.a.createElement("nav",null,r.a.createElement("div",{className:"nav-wrapper"},r.a.createElement(i.b,{className:"brand-logo",to:"/"},"Mafia"),r.a.createElement("a",{href:"#!","data-target":"mobile",className:"sidenav-trigger"},r.a.createElement("i",{className:"material-icons"},"menu")),r.a.createElement("ul",{className:"right hide-on-med-and-down"},a))),r.a.createElement("ul",{className:"sidenav",id:"mobile"},a))}}]),a}(n.Component),S=Object(b.e)(N),C=function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"container"})}}]),a}(n.Component),k=function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"container"},"Hello from materialize-css")}}]),a}(n.Component),w=t(19),O=t(22),j=t(20),x=t.n(j),I=t(13),R=function(e){var a=e.prefix?r.a.createElement("i",{className:"material-icons prefix"},e.prefix):r.a.createElement(n.Fragment,null);return r.a.createElement("div",{className:"input-field"},a,r.a.createElement(O.b,{type:e.type,name:e.name}),r.a.createElement("label",{htmlFor:e.name},e.title),r.a.createElement(O.a,{name:e.name,component:e.component}))};function q(){var e=Object(w.a)(["\nmutation TokenAuth($username: String!, $password: String!) {\n  tokenAuth(username: $username, password: $password) {\n    token\n  }\n}"]);return q=function(){return e},e}var _=x()(q()),M=I.object().shape({username:I.string().min(4,"Too short").max(50,"Too long").required("Required"),password:I.string().required("Password required")}),P=function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement(l.c,{mutation:_,update:function(a,t){var n=t.data.tokenAuth.token;localStorage.setItem("token",n),e.props.history.push("/")}},function(e,a){a.data;return r.a.createElement(O.d,{initialValues:{username:"",password:""},validationSchema:M,onSubmit:function(a,t){var n=a.username,r=a.password;e({variables:{username:n,password:r}})},render:function(e){e.errors,e.status,e.touched;var a=e.isSubmitting;return r.a.createElement(O.c,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement("div",{className:"row"},r.a.createElement(R,{type:"text",name:"username",component:"p",title:"Username"})),r.a.createElement("div",{className:"row"},r.a.createElement(R,{type:"password",name:"password",component:"p",title:"Password"})),r.a.createElement("button",{type:"submit",className:"btn",disabled:a},"Submit"))))}})})))}}]),a}(n.Component);function H(){var e=Object(w.a)(["\nmutation CreateUser($username: String!, $email: String!, $password: String!) {\n  createUser(username: $username, email: $email, password: $password) {\n    user {\n      id\n    }\n  }\n}"]);return H=function(){return e},e}var D=x()(H()),$=I.object().shape({username:I.string().min(4,"Too short").max(50,"Too long").required("Required"),email:I.string().email("Invalid email").required("Required"),password:I.string().required("Password required"),passwordConfirm:I.string().oneOf([I.ref("password")],"Passwords must match").required("Required")}),L=function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement(l.c,{mutation:D,update:function(a,t){var n=t.data.createUser.user.id;console.log(n),e.props.history.push("/login")}},function(e,a){a.data;return r.a.createElement(O.d,{initialValues:{username:"",email:"",password:"",passwordConfirm:""},validationSchema:$,onSubmit:function(a,t){var n=a.username,r=a.email,s=a.password;e({variables:{username:n,email:r,password:s}})},render:function(e){e.errors,e.status,e.touched;var a=e.isSubmitting;return r.a.createElement(O.c,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"text",name:"username",component:"p",title:"Username"})),r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"text",name:"email",component:"p",title:"Email"}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"password",name:"password",component:"p",title:"Password"})),r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"password",name:"passwordConfirm",component:"p",title:"Password Confirm"}))),r.a.createElement("button",{type:"submit",className:"btn",disabled:a},"Submit"))))}})})))}}]),a}(n.Component);function A(){var e=Object(w.a)(["\nquery {\n  statistic {\n    user {\n      username\n    }\n    gamesCount\n    gamesWon\n    gamesLost\n    asMafia\n    asCitizen\n    asSheriff\n    asDoctor\n  }\n}"]);return A=function(){return e},e}var G=x()(A()),T=function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement(l.d,{query:G},function(e){var a=e.loading,t=e.error,n=e.data;return a?r.a.createElement("div",{className:"progress"},r.a.createElement("div",{className:"indeterminate"})):t?"Error! ".concat(t.message):(n=n.statistic,r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-content"},r.a.createElement("span",{className:"card-title"},r.a.createElement("b",null,n.user.username)),r.a.createElement("ul",{className:"collection"},r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.gamesCount),"Games"),r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.gamesWon),"Wins"),r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.gamesLost),"Loses"),r.a.createElement("li",{className:"collection-item"},r.a.createElement("center",null,r.a.createElement("b",null,"Classic"))),r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.asMafia),"Games as Mafia"),r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.asCitizen),"Games as Citizen"),r.a.createElement("li",{className:"collection-item"},r.a.createElement("center",null,r.a.createElement("b",null,"Extended"))),r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.asSheriff),"Games as Sheriff"),r.a.createElement("li",{className:"collection-item"},r.a.createElement("span",{className:"badge"},n.asDoctor),"Games as Doctor")))))})))}}]),a}(n.Component),B=t(152),U=t.n(B);function F(){var e=Object(w.a)(["\nmutation DeleteGame($id: Int!) {\n  deleteGame(id: $id) {\n    result\n  }\n}"]);return F=function(){return e},e}function J(){var e=Object(w.a)(["\nquery {\n  me {\n    id\n  }\n}"]);return J=function(){return e},e}var W=x()(J()),V=x()(F()),z=function(e){function a(){var e,t;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(t=Object(v.a)(this,(e=Object(E.a)(a)).call.apply(e,[this].concat(r)))).state={id:void 0,fetch:!0},t.setUserId=function(e){return t.setState({id:e,fetch:!1})},t}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){var e=this,a=this.props.obj,t=a.extended?"Extended":"Classic",s=a.extended?r.a.createElement(n.Fragment,null,"As Doctor: ",a.peopleAsDoctor,r.a.createElement("br",null),"As Sheriff: ",a.peopleAsSheriff,r.a.createElement("br",null)):r.a.createElement(n.Fragment,null),c=this.state.id===a.creator.id?r.a.createElement(l.c,{mutation:V},function(t,n){n.data;return r.a.createElement("a",{href:"#",onClick:function(n){t({variables:{id:a.id}}),e.props.refetch()}},"Delete")}):r.a.createElement(n.Fragment,null);return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-content"},r.a.createElement("span",{className:"card-title"},a.name),t,r.a.createElement("br",null),"Players: ",a.players,r.a.createElement("br",null),"As Mafia: ",a.peopleAsMafia,r.a.createElement("br",null),s,"Creator: ",a.creator.username,r.a.createElement("br",null),"Created at: ",r.a.createElement(U.a,null,a.createdAt)),r.a.createElement("div",{className:"card-action"},r.a.createElement(l.a,null,function(a){return e.state.fetch&&a.query({query:W}).then(function(a){e.setUserId(a.data.me.id)}),r.a.createElement(n.Fragment,null,r.a.createElement(i.b,{to:"game/".concat(e.props.obj.id)},"Join"),c)})))}}]),a}(n.Component);function Q(){var e=Object(w.a)(["\nquery Games($q: String, $first: Int, $skip: Int) {\n  games(search: $q, first: $first, skip: $skip) {\n    id\n    creator {\n      id\n      username\n    }\n    name\n    players\n    peopleAsMafia\n    peopleAsDoctor\n    peopleAsSheriff\n    extended\n    createdAt\n  }\n}"]);return Q=function(){return e},e}var Y=x()(Q()),K=function(e){function a(){var e,t;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(t=Object(v.a)(this,(e=Object(E.a)(a)).call.apply(e,[this].concat(r)))).state={q:"",first:10,skip:0,page:1},t.setQuery=function(e){return t.setState({q:e})},t.nextPage=function(){return t.setState({first:t.state.first+10,skip:t.state.skip+10,page:t.state.page+1})},t.prevPage=function(){t.state.page>1&&t.setState({first:t.state.first-10,skip:t.state.skip-10,page:t.state.page-1})},t}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement(O.d,{initialValues:{q:""},onSubmit:function(a,t){var n=a.q;e.setQuery(n)},render:function(a){a.errors,a.status,a.touched,a.isSubmitting;return r.a.createElement(O.c,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement("div",{className:"row"},r.a.createElement(R,{type:"text",name:"q",component:"p",title:"Search",prefix:"search"})),r.a.createElement(l.d,{query:Y,variables:{q:e.state.q,first:e.state.first,skip:e.state.skip}},function(e){var a=e.loading,t=e.error,s=e.data,c=e.refetch;return a?r.a.createElement("div",{className:"progress"},r.a.createElement("div",{className:"indeterminate"})):t?"Error! ".concat(t.message):(s=s.games,r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement(i.b,{to:"createGame",className:"btn"},r.a.createElement("i",{className:"material-icons left"},"add"),"Create Game"),r.a.createElement("button",{className:"btn",onClick:function(){return c()}},r.a.createElement("i",{className:"material-icons left"},"refresh"),"Refresh")),s.map(function(e,a){return r.a.createElement("div",{className:"row",key:e.id},r.a.createElement(z,{obj:e,refetch:c}))})))}),r.a.createElement("div",{className:"row"},r.a.createElement("ul",{className:"pagination center-align"},r.a.createElement("li",{className:1===e.state.page?"disabled":"enabled"},r.a.createElement("a",{href:"#!",onClick:function(a){return e.prevPage()}},r.a.createElement("i",{className:"material-icons"},"chevron_left"))),r.a.createElement("li",{className:"active"},r.a.createElement("a",{href:"#!"},e.state.page)),r.a.createElement("li",{className:"waves-effect"},r.a.createElement("a",{href:"#!",onClick:function(a){return e.nextPage()}},r.a.createElement("i",{className:"material-icons"},"chevron_right"))))))))}})))}}]),a}(n.Component),X=t(153),Z=t(154),ee=t.n(Z),ae=(t(303),{maxWidth:"100%"}),te={minHeight:"40px"},ne=function(e){function a(e){var t;return Object(p.a)(this,a),(t=Object(v.a)(this,Object(E.a)(a).call(this,e))).videoRef=r.a.createRef(),t.state={checkPlayerButtonHidden:!0,killPlayerButtonHidden:!0,voteForPlayerButtonHidden:!0},t}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-contents",style:te},r.a.createElement("span",{className:"player-name"},this.props.playerName),!this.state.voteForPlayerButtonHidden&&r.a.createElement("button",{className:"btn-floating right waves-effect waves-light red"},r.a.createElement("i",{className:"material-icons"},"priority_high")),!this.state.checkPlayerButtonHidden&&r.a.createElement("button",{className:"btn-floating right waves-effect waves-light red"},r.a.createElement("i",{className:"material-icons"},"search")),!this.state.killPlayerButtonHidden&&r.a.createElement("button",{className:"btn-floating right waves-effect waves-light red"},r.a.createElement("i",{className:"material-icons"},"smoking_rooms"))),r.a.createElement("div",{className:"container-video"},r.a.createElement("video",{id:"video-"+this.props.card_id,ref:this.videoRef,style:ae,poster:ee.a,autoPlay:!0})))}}]),a}(n.Component),re=t(11);function se(){var e=Object(w.a)(["\nquery {\n  me {\n    id\n  }\n}"]);return se=function(){return e},e}function ce(){var e=Object(w.a)(["\nmutation CreateGamePlayer($gameId: Int!) {\n  createGamePlayer(gameId: $gameId) {\n    gamePlayer {\n      token\n    }\n  }\n}"]);return ce=function(){return e},e}var ie=x()(ce()),oe={marginBottom:0},le=x()(se()),me=function(e){function a(e){var t;Object(p.a)(this,a),(t=Object(v.a)(this,Object(E.a)(a).call(this,e))).state={isLoading:!0,gameState:"connecting",mutationHasDone:!1,token:void 0,playerNames:void 0,playerIds:void 0,mafias:void 0},t.socket=void 0,t.gameId=t.props.match.params.gameId,t.mediaConstraints={audio:!0,video:!0},t.peerConnections={},t.videoHandlePlayerJoinedMsg=function(e){t.videoCreatePeerConnection(e.player_id),navigator.mediaDevices.getUserMedia(t.mediaConstraints).then(function(a){a.getTracks().forEach(function(n){return t.peerConnections[e.player_id].addTrack(n,a)})}).catch(t.videoHandleGetUserMediaError)},t.videoHandlePlayerDisconnectedMsg=function(e){t.videoEndVideoStreaming(e.player_id)},t.videoHandleVideoOfferMsg=function(e){if(t.peerConnections[e.player_id])console.error("peerConnection already exists!");else{var a=null;t.videoCreatePeerConnection(e.player_id),t.peerConnections[e.player_id].onnegotiationneeded=null;var n=new RTCSessionDescription(e.sdp);t.peerConnections[e.player_id].setRemoteDescription(n).then(function(){return navigator.mediaDevices.getUserMedia(t.mediaConstraints)}).then(function(n){(a=n).getTracks().forEach(function(n){return t.peerConnections[e.player_id].addTrack(n,a)})}).then(function(){return t.peerConnections[e.player_id].createAnswer()}).then(function(a){return t.peerConnections[e.player_id].setLocalDescription(a)}).then(function(){t.videoSendToServer({type:"video-answer",game_id:e.game_id,player_id:t.playerId,target_id:e.player_id,sdp:t.peerConnections[e.player_id].localDescription})}).catch(t.videoHandleGetUserMediaError)}},t.videoHandleVideoAnswerMsg=function(e){var a=new RTCSessionDescription(e.sdp);t.peerConnections[e.player_id].setRemoteDescription(a).then(function(){console.log("setRemoteDescription(answer) succsess in promise")}).catch(t.videoHandleError)},t.videoHandleNewICECandidateMsg=function(e){var a=new RTCIceCandidate(e.candidate);t.peerConnections[e.player_id].addIceCandidate(a).then(function(){console.log("addIceCandidate(candidate) success in promise")}).catch(t.videoHandleError)},t.videoCreatePeerConnection=function(e){console.log("creating new peer");var a=new RTCPeerConnection({iceServers:[{urls:"stun:stun3.l.google.com:19302"}]});a.onicecandidate=function(a){return t.videoHandleICECandidateEvent(a,e)},a.ontrack=function(a){return t.videoHandleTrackEvent(a,e)},a.onnegotiationneeded=function(){return t.videoHandleNegotiationNeededEvent(e)},t.peerConnections[e]=a},t.videoHandleICECandidateEvent=function(e,a){console.log("videoHandleICECandidateEvent triggered"),e.candidate&&t.videoSendToServer({type:"new-ice-candidate",game_id:t.gameId,player_id:t.playerId,target_id:a,candidate:e.candidate})},t.videoHandleNegotiationNeededEvent=function(e){console.log("videoHandleNegotiationNeededEvent triggered"),t.peerConnections[e].createOffer().then(function(a){return t.peerConnections[e].setLocalDescription(a)}).then(function(){t.videoSendToServer({type:"video-offer",game_id:t.gameId,player_id:t.playerId,target_id:e,sdp:t.peerConnections[e].localDescription})}).catch(t.videoHandleError)},t.videoHandleTrackEvent=function(e,a){console.log("videoHandleTrackEvent triggered"),document.getElementById("video-".concat(a)).srcObject=e.streams[0]},t.videoEndVideoStreaming=function(e){var a=document.getElementById("video-"+e);a.srcObject&&a.srcObject.getTracks().forEach(function(e){return e.stop()}),e!=t.playerId&&(t.peerConnections[e].close(),delete t.peerConnections[e])},t.videoSendToServer=function(e){t.signalingSocket.send(JSON.stringify(e))},t.videoHandleGetUserMediaError=function(e){switch(e.name){case"NotFoundError":alert("Unable to open your call because no camera and/or microphone were found.");break;case"SecurityError":case"PermissionDeniedError":break;default:alert("Error opening your camera and/or microphone: "+e.message)}},t.videoHandleError=function(e){console.error("Error "+e.name+": "+e.message)},t.testGetPeers=function(){console.log(t.peerConnections)},t.playerCardRefs={};for(var n=0;n<10;n++)t.playerCardRefs[n]={ref:r.a.createRef()};return t.signalingSocket=new WebSocket("ws://localhost:8000/ws/signaling-socket/?access_token=".concat(localStorage.getItem("token"))),t.signalingSocket.addEventListener("message",function(e){var a=JSON.parse(e.data);switch(console.log(a),a.type){case"player-joined":t.videoHandlePlayerJoinedMsg(a);break;case"player-disconnected":t.videoHandlePlayerDisconnectedMsg(a);break;case"video-offer":t.videoHandleVideoOfferMsg(a);break;case"video-answer":t.videoHandleVideoAnswerMsg(a);break;case"new-ice-candidate":t.videoHandleNewICECandidateMsg(a)}}),t.signalingSocket.addEventListener("open",function(e){Se.query({query:le}).then(function(e){t.playerId=parseInt(e.data.me.id),t.videoSendToServer({type:"player-joined",game_id:t.gameId,player_id:t.playerId})});var a=t.playerCardRefs;navigator.mediaDevices.getUserMedia(t.mediaConstraints).then(function(e){a[t.playerId].ref.current.videoRef.current.srcObject=e,a[t.playerId].ref.current.videoRef.current.muted=!0}).catch(t.videoHandleGetUserMediaError)}),t}return Object(g.a)(a,e),Object(f.a)(a,[{key:"shouldComponentUpdate",value:function(e,a,t){return!0}}]),Object(f.a)(a,[{key:"componentWillUnmount",value:function(){this.signalingSocket.readyState===WebSocket.OPEN&&(this.signalingSocket.onclose=function(){},this.signalingSocket.close()),void 0!==this.socket&&this.socket.readyState===WebSocket.OPEN&&(this.socket.onclose=function(){},this.socket.close()),this.videoEndVideoStreaming(this.playerId)}},{key:"render",value:function(){var e=this;if(void 0===this.state.playerNames){for(var a=[],t=0;t<10;t++)a.push("loading");this.state.playerNames=a,this.state.playerIds=[]}var n=[re.ClimbingBoxLoader,re.BarLoader,re.BeatLoader,re.BounceLoader,re.CircleLoader,re.ClipLoader,re.DotLoader,re.FadeLoader,re.GridLoader,re.HashLoader,re.MoonLoader,re.PacmanLoader,re.PropagateLoader,re.PulseLoader,re.ReactSpinners,re.RingLoader,re.RiseLoader,re.RotateLoader,re.ScaleLoader,re.SyncLoader],s=n[Math.floor(Math.abs(10*Math.random()))%n.length];return r.a.createElement("div",{className:"container"},r.a.createElement(l.c,{mutation:ie,variables:{gameId:this.props.match.params.gameId},update:function(a,t){var n=t.data;e.setState({gameState:"waiting players",token:n.createGamePlayer.gamePlayer.token}),void 0===e.socket&&(e.socket=new WebSocket("ws://localhost:8000/gameAwait/")),e.socket.onopen=function(a){var t={type:"update info",token:e.state.token};e.socket.send(JSON.stringify(t))},e.socket.onmessage=function(a){var t=JSON.parse(a.data);if(console.log(t.players),"update info"===t.type){for(var n=0;n<t.players.length;n++)e.state.playerNames[n]=t.players[n],e.state.playerIds[n]=t.players_id[n];for(var r=t.players.length;r<10;r++)e.state.playerNames[r]="loading";e.setState({})}else"sleep"===t.type?e.setState({gameState:"Whole city is sleeping... Only mafias still work..."}):"wakeup mafia"===t.type?e.setState({gameState:"mafia vote",mafias:t.players}):"wakeup inhabitants"===t.type?e.setState({gameState:"inhabitant vote"}):"game over"===t.type?e.setState({gameState:"YOU LOSE!"}):"game win"===t.type?e.setState({gameState:"YOU WIN!"}):"remove player"===t.type||"message"===t.type&&e.setState({gameState:t.message})}}},function(a,t){t.data;return e.state.mutationHasDone||(e.setState({mutationHasDone:!0}),a()),r.a.createElement("div",null)}),r.a.createElement("div",Object(X.a)({className:"row",style:oe},"style",oe),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[0].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[0].ref,card_id:0,playerName:this.state.playerNames[0]})),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[1].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[1].ref,card_id:1,playerName:this.state.playerNames[1]})),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[2].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[2].ref,card_id:2,playerName:this.state.playerNames[2]})),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[3].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[3].ref,card_id:3,playerName:this.state.playerNames[3]}))),r.a.createElement("div",{className:"row valign-wrapper",style:oe},r.a.createElement("div",{className:"col s3"},this.playerCardRefs[9].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[9].ref,card_id:9,playerName:this.state.playerNames[9]})),r.a.createElement("div",{className:"col s6"},r.a.createElement("div",{className:"card center"},r.a.createElement("span",{className:"card-title"},function(){return"inhabitant vote"===e.state.gameState?r.a.createElement("form",{onSubmit:function(a){var t=document.getElementById("select"),n={type:"inhabitant vote",player:t.option[t.selectedIndex].value};return e.socket.send(JSON.stringify(n)),!1}},r.a.createElement("select",{id:"select"},function(){for(var a="",t=e.state.playerNames,n=0;n<t.length;n++)a+='<option value="'.concat(t[n],'">').concat(t[n],"</option>");return a})):"mafia vote"===e.state.gameState?r.a.createElement("form",{onSubmit:function(a){var t=document.getElementById("select"),n={type:"mafia vote",player:t.option[t.selectedIndex].value};return e.socket.send(JSON.stringify(n)),!1}},r.a.createElement("select",{id:"select"},function(){for(var a="",t=e.state.playerNames,n=e.state.mafias,r=0;r<t.length;r++){for(var s=!1,c=0;c<n.length;c++)if(t[r]===n[c]){s=!0;break}s||(a+='<option value="'.concat(t[r],'">').concat(t[r],"</option>"))}return a})):e.state.gameState}),r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement(s,{size:20,sizeUnit:"px",color:"#1dbc98",loading:this.state.isLoading})),r.a.createElement("div",{className:"card-content"},r.a.createElement("p",null,"Alert"),r.a.createElement("p",null,"Info"),r.a.createElement("p",null,"Other functionality"),r.a.createElement("button",{className:"btn waves-effect waves-light",onClick:this.testGetPeers},"Get peers")))),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[4].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[4].ref,card_id:4,playerName:this.state.playerNames[4]}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s3"},this.playerCardRefs[8].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[8].ref,card_id:8,playerName:this.state.playerNames[8]})),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[7].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[7].ref,card_id:7,playerName:this.state.playerNames[7]})),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[6].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[6].ref,card_id:6,playerName:this.state.playerNames[6]})),r.a.createElement("div",{className:"col s3"},this.playerCardRefs[5].ref&&r.a.createElement(ne,{ref:this.playerCardRefs[5].ref,card_id:5,playerName:this.state.playerNames[5]}))))}}]),a}(n.Component),de=t(155);function ue(){var e=Object(w.a)(["\nquery {\n  cardSets {\n    id\n    name\n    extended\n  }\n}"]);return ue=function(){return e},e}function pe(){var e=Object(w.a)(["\nmutation CreateGame($name: String!, $extended: Boolean!, $cardSet: Int!, $players: Int!, $asMafia: Int!, $asDoctor: Int, $asSheriff: Int) {\n  createGame(name: $name, extended: $extended, cardSet: $cardSet, players: $players, asMafia: $asMafia, asDoctor: $asDoctor, asSheriff: $asSheriff) {\n    game {\n      id\n    \tname\n    \tcreator {\n      \tid\n      \tusername\n    \t}\n    }\n  }\n}"]);return pe=function(){return e},e}var fe=x()(pe()),ve=x()(ue()),Ee=I.object().shape({name:I.string().min(4,"Too short").max(255,"Too long").required("Required"),extended:I.boolean(),cardSet:I.string().notOneOf(["","0"],"Select Card Set").required("Required"),players:I.number().min(5,"Minimum number of people is 5").max(10,"Maximum number of people is 10").required("Required"),asMafia:I.number().min(1,"Minimum number as mafia is 1").max(4,"Maximum number as mafia is 4").required("Required"),asDoctor:I.number().min(1,"Minimum is 1").max(2,"Maximum is 2"),asSheriff:I.number().min(1,"Minimum is 1").max(2,"Maximum is 2")}),ge=function(e){function a(){var e,t;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(t=Object(v.a)(this,(e=Object(E.a)(a)).call.apply(e,[this].concat(r)))).state={cardSets:[],fetch:!0,extended:!1},t.setCardSets=function(e){return t.setState({cardSets:e,fetch:!1})},t.changeExtended=function(){return t.setState({extended:!t.state.extended})},t}return Object(g.a)(a,e),Object(f.a)(a,[{key:"componentDidUpdate",value:function(){var e=document.querySelectorAll("select");y.a.FormSelect.init(e,{})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement(l.c,{mutation:fe,update:function(a,t){t.data.createGame.game.id&&e.props.history.push("games")}},function(a,t){t.data;return r.a.createElement(l.a,null,function(t){return e.state.fetch&&t.query({query:ve}).then(function(a){console.log(a.data.cardSets),e.setCardSets(a.data.cardSets)}),r.a.createElement(O.d,{initialValues:{name:"",extended:e.state.extended,cardSet:"0",players:5,asMafia:1,asDoctor:1,asSheriff:1},validationSchema:Ee,onSubmit:function(e,t){e.cardSet=parseInt(e.cardSet),a({variables:e})},render:function(a){a.errors,a.status,a.touched;var t=a.isSubmitting,s=(a.handleSubmit,a.handleChange),c=a.handleBlur,i=a.values;return r.a.createElement(O.c,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s8 offset-s2"},r.a.createElement("div",{className:"row"},r.a.createElement(R,{type:"text",name:"name",component:"p",title:"Name"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s6"},r.a.createElement("div",{className:"input-field"},r.a.createElement("label",null,r.a.createElement("input",{name:"extended",type:"checkbox",value:i.extended,checked:i.extended,onChange:function(a){e.changeExtended(),s(a)},onBlur:c}),r.a.createElement("span",null,"Extended")))),r.a.createElement("div",{className:"col s6"},r.a.createElement("div",{className:"input-field"},r.a.createElement("select",{name:"cardSet",value:i.cardSet,onChange:s,onBlur:c},[r.a.createElement("option",{key:0,value:"0",disabled:!0},"Select Card Set")].concat(Object(de.a)(e.state.cardSets.filter(function(e){return e.extended===i.extended}).map(function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.name)})))),r.a.createElement("label",null,"Card Set"),r.a.createElement(O.a,{name:"cardSet",component:"p"})))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"number",name:"players",component:"p",title:"Players"})),r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"number",name:"asMafia",component:"p",title:"As Mafia"}))),i.extended?r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"number",name:"asDoctor",component:"p",title:"As Doctor"})),r.a.createElement("div",{className:"col s6"},r.a.createElement(R,{type:"number",name:"asSheriff",component:"p",title:"As Sheriff"}))):r.a.createElement(n.Fragment,null),r.a.createElement("button",{type:"submit",className:"btn",disabled:t},"Create"))))}})})})))}}]),a}(n.Component),he=function(e){return r.a.createElement(b.c,null,r.a.createElement(b.a,{exact:!0,path:"/",component:k}),r.a.createElement(b.a,{path:"/login",component:P}),r.a.createElement(b.a,{path:"/reg",component:L}),r.a.createElement(b.a,{path:"/profile",component:T}),r.a.createElement(b.a,{path:"/games",component:K}),r.a.createElement(b.a,{path:"/game/:gameId",component:me}),r.a.createElement(b.a,{path:"/createGame",component:ge}))},ye=(t(330),function(e){function a(){return Object(p.a)(this,a),Object(v.a)(this,Object(E.a)(a).apply(this,arguments))}return Object(g.a)(a,e),Object(f.a)(a,[{key:"render",value:function(){return r.a.createElement(n.Fragment,null,r.a.createElement("header",null,r.a.createElement(S,null)),r.a.createElement("main",null,r.a.createElement(he,this.props)),r.a.createElement("footer",{className:"page-footer"},r.a.createElement(C,null)))}}]),a}(n.Component));t(331);t.d(a,"client",function(){return Se});var be=Object(m.a)({uri:"/graphql/",credentials:"same-origin"}),Ne=new d.a(function(e,a){var t=localStorage.getItem("token");return e.setContext({headers:{authorization:t?"JWT ".concat(t):""}}),a(e)}),Se=new o.c({link:Object(d.b)(Ne,be),cache:new u.a,fetchOptions:{mode:"no-cors"}}),Ce=r.a.createElement(l.b,{client:Se},r.a.createElement(i.a,null,r.a.createElement(ye,null)));c.a.render(Ce,document.getElementById("root"))}},[[159,1,2]]]);
//# sourceMappingURL=main.40f260ab.chunk.js.map